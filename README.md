# weather research

## プログラムの内容
気象庁が公開しているデータのうち、日別の最高気温・最低気温のデータおよび日別の降水量のデータを使用し、前者は1年間のデータの分布をまとめた散布図、後者は日ごとの折れ線グラフの比較、もしくは棒グラフによる可視化を可能にした。  
グラフ描画にはmatplotlibを用いた。  
それぞれのデータは観測地点ごとに別のフォルダにCSVで保存されていて、最高気温・最低気温のデータは **maxmin_{西暦}.csv** という名前で年ごとに分かれており、降水量のデータは **rain.csv**という名前で10年分が一つのファイルに保存されている。  

ユーザーが対話的に設定できるパラメータは以下のようなものを設定できるようにした。
* 気温データの比較（散布図）
    * プロットするデータの個数(1以上3以下)
    * データの観測地点（札幌・東京・横浜・松本・那覇）
    * 各データをプロットする色  
    * 各データの年度  
  
* 降水量データの比較（折れ線グラフ）
    * プロットするデータの個数(1以上3以下)
    * データの観測地点（札幌・東京・横浜・松本・那覇）
    * 各データをプロットする色  
    * 描画する期間  
  
* 降水量データの表示（棒グラフ）
    * データの観測地点
    * 描画する日付
***
## 工夫したところ
プロットするデータの個数を変更すると自動でパラメータの入力欄の数も変化するようにJavaScriptでHTMLのクラスを付与・削除できるようにした。入力欄の数が自動で変わるたびにそれぞれの文章の位置が上下するとごちゃごちゃした印象を与えると思ったため、データの個数に応じて変化する入力欄の表示・非表示はCSSの *visibility: hidden;* で切り替えた。  
一方、プロットするデータの種類に応じて変化する部分は *visibility: hidden;* であると余計な空白が生まれてしまうため *display: none;* で対応した。  

***
## 苦労したところ
降水量のデータがまとまっている**rain.csv**が気象庁のHPからダウンロードしてきたままのデータであると、  

|年月日|降水量の合計(mm)|降水量の合計(mm)|降水量の合計(mm)|降水量の合計(mm)|  
|---|---|---|---|---|  
|　|　|現象なし情報|品質情報|均質番号|  
|2010/1/1|0|1|8|1|  
|2010/1/2|0|1|8|1|  
  
のようになっていて、headerにしたい行とデータが始まる行が離れている上にheaderにしたい行の5個の見出しのうち4個が同じ名前になっているという点で困った。現象なし情報・品質情報・均質情報という文字列は行を変えず上の段の降水量の合計(mm)と同じセルに続けて書いても問題ない内容なので別の列に分けずに出力するようにしてもらいたいと思った。  
また、それに伴い、pandasでCSVを読み込む際に *names=(・・・)* で設定して読み込もうとしたが、 *parse_dates=True*がうまく動かなかったため、ひとまず自分でCSVにheaderにする行を以下の様に書き加えた。  
|date|rain|a|b|c|  
|---|---|---|---|---|  
  
↑自分で書き加えた行  

***
## やりたりなかったこと
降水量比較のグラフは横着して折れ線グラフでの表示としたが、一般には降水量は棒グラフで表示することが多いような気がしたため、それとは別に棒グラフで降水量を表示するモードを作成した。しかし、他2つのモード（最高気温・最小気温、降水量比較）とは異なり、同時に表示できるデータ数が1つだけであったり、表示する期間は2週間に固定されているなどあまり自由度が高いことができなくなってしまった。  
棒グラフを複数同時に表示することはできるが、あまり見栄えが良くなかったので1つのみの表示とした。表示される期間は2週間ではなくてもよかったが、グラフの描画の際にpandasのDataFrameを複数回参照しているため、描画する期間に長い期間を設定することで処理時間が長くなりすぎないように2週間で固定した。  
それでも棒グラフの表示には4秒ほどかかってしまうので本当はもっと高速に処理できるようにしたいが、どこを変更すれば解決できるかわからなかった。  
***
## データの取得場所
* [気象庁HP](https://www.data.jma.go.jp/gmd/risk/obsdl/index.php)